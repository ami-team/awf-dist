(()=>{"use strict";var t,e,n={},i={};function a(t){var e=i[t];if(void 0!==e)return e.exports;var r=i[t]={exports:{}};return n[t](r,r.exports,a),r.exports}a.m=n,a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce(((e,n)=>(a.f[n](t,e),e)),[])),a.u=t=>"assets/js/chunks/"+t+".min.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="awf:",a.l=(n,i,r,o)=>{if(t[n])t[n].push(i);else{var s,l;if(void 0!==r)for(var d=document.getElementsByTagName("script"),p=0;p<d.length;p++){var c=d[p];if(c.getAttribute("src")==n||c.getAttribute("data-webpack")==e+r){s=c;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",e+r),s.src=n),t[n]=[i];var h=(e,i)=>{s.onerror=s.onload=null,clearTimeout(m);var a=t[n];if(delete t[n],s.parentNode&&s.parentNode.removeChild(s),a&&a.forEach((t=>t(i))),e)return e(i)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),l&&document.head.appendChild(s)}},a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=n[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t+"../../"})(),(()=>{var t={838:0};a.f.j=(e,n)=>{var i=a.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise(((n,a)=>i=t[e]=[n,a]));n.push(i[2]=r);var o=a.p+a.u(e),s=new Error;a.l(o,(n=>{if(a.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;s.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",s.name="ChunkLoadError",s.type=r,s.request=o,i[1](s)}}),"chunk-"+e,e)}};var e=(e,n)=>{var i,r,[o,s,l]=n,d=0;if(o.some((e=>0!==t[e]))){for(i in s)a.o(s,i)&&(a.m[i]=s[i]);if(l)l(a)}for(e&&e(n);d<o.length;d++)r=o[d],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0},n=self.webpackChunkawf=self.webpackChunkawf||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var r,o,s,l,d;(r||(r={})).load=function(){return a.e(975).then(a.bind(a,8975)).then((t=>t.Base91.load()))},function(t){t.load=function(){return a.e(191).then(a.bind(a,6191)).then((t=>t.DuckDB.load()))}}(o||(o={})),function(t){t.load=function(){return a.e(784).then(a.bind(a,7784)).then((t=>t.Expat.load()))}}(s||(s={})),function(t){t.load=function(){return a.e(305).then(a.bind(a,7305)).then((t=>t.Graphviz.load()))}}(l||(l={})),function(t){t.load=function(){return a.e(395).then(a.bind(a,8395)).then((t=>t.Zstd.load()))}}(d||(d={})),$AMIClass("GraphCtrl",{$extends:ami.Control,$init:function(t,e){this.$super.$init(t,e)},onReady:function(){const t=$.Deferred();return this.fragmentGraphCtrl='<nav class="navbar navbar-expand-lg navbar-light bg-light rounded-top border mb-1" style="padding: 0.1rem 0.75rem 0.1rem 1.0rem;">\n\t<div class="form-inline m{% if BOOTSTRAP_VERSION > 4 %}e{% else %}r{% endif %}-2">\n\t\t<span class="switch switch-sm switch-off-primary switch-on-secondary">\n\t\t\t<input type="checkbox" id="A8E7C88D_7B78_B221_0BCB_6EF1F9CC3C15" />\n\t\t\t<label for="A8E7C88D_7B78_B221_0BCB_6EF1F9CC3C15">\n\t\t\t\t<span class="text-primary">Horizontal view</span>\n\t\t\t\t/\n\t\t\t\t<span class="text-secondary">Vertical view</span>\n\t\t\t</label>\n\t\t</span>\n    </div>\n\t<ul class="navbar-nav m{% if BOOTSTRAP_VERSION > 4 %}e{% else %}r{% endif %}-auto">\n\t\t<li class="nav-item dropdown">\n\t\t\t<a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-boundary="viewport">Export</a>\n\t\t\t<div class="dropdown-menu">\n\t\t\t\t<a class="dropdown-item" href="#" id="E90168C4_E4BD_ACC8_085F_9953D6CF789F">SVG</a>\n\t\t\t</div>\n\t\t</li>\n    </ul>\n\t{% if mode === \'json\' %}\n\t<div class="form-inline my-2 my-lg-0">\n\t\t<div class="input-group input-group-sm mb-1">\n\t\t\t<input class="form-control" type="text" id="D9256B01_3DBE_6E51_AA91_B2F80944607D" placeholder="Type a regexp" style="min-width: 400px;" />\n\t\t\t{% if BOOTSTRAP_VERSION > 4 %}\n\t\t\t<button class="btn btn-primary" type="button" id="EC45916B_DC77_AD27_8117_E84FC2598196">Filter</button>\n\t\t\t{% else %}\n\t\t\t<div class="input-group-append">\n\t\t\t\t<button class="btn btn-primary" type="button" id="EC45916B_DC77_AD27_8117_E84FC2598196">Filter</button>\n\t\t\t</div>\n\t\t\t{% endif %}\n\t\t</div>\n\t</div>\n\t{% endif %}\n</nav>\n\n<div id="A0F6763F_DE29_5185_35C1_DCAA81E8C487" style="overflow: auto"></div>\n',this.fragmentGraph="{{ graph }}",l.load().then((t=>{this.graphviz=t})).catch((e=>{t.reject(e)})),t},render:function(t,e,n){const i=$.Deferred();return this.setupCtx({command:e},{context:i,direction:"LR"},n),amiCommand.execute(this.ctx.command).done((e=>{""!==(this.dotString=amiWebApp.jspath('..rowset{.@type==="graph"}.row.field{.@name==="dot"}.$',e)[0]||"")?this.mode="dot":(this.json=e,this.dotString=this.jsonToDot(this.json,""),this.mode="json"),this.replaceHTML(t,this.fragmentGraphCtrl,{dict:{mode:this.mode}}).done((()=>{$(this.patchId("#A8E7C88D_7B78_B221_0BCB_6EF1F9CC3C15")).change((t=>{t.preventDefault(),this.switchDirection()})),$(this.patchId("#E90168C4_E4BD_ACC8_085F_9953D6CF789F")).click((t=>{t.preventDefault(),this.exportSVG()})),$(this.patchId("#EC45916B_DC77_AD27_8117_E84FC2598196")).click((t=>{t.preventDefault(),this.dotString=this.jsonToDot(this.json,$(this.patchId("#D9256B01_3DBE_6E51_AA91_B2F80944607D")).val().trim()),this.display()})),$(this.patchId("#D9256B01_3DBE_6E51_AA91_B2F80944607D")).keypress((t=>{13==t.keyCode&&(this.dotString=this.jsonToDot(this.json,$(this.patchId("#D9256B01_3DBE_6E51_AA91_B2F80944607D")).val().trim()),this.display())})),this.display().done((()=>{i.resolveWith(this.ctx.context,[e])}))}))})).fail((t=>{i.rejectWith(this.ctx.context,[t])})),i.promise()},display:function(){amiWebApp.lock();const t=$.Deferred();this.graph=this.graphviz.dot(this.dotString,"svg"),this.graph=this.graph.replace(/xlink:href="([^"]*)"/g,((t,e)=>{const n=JSON.parse(amiWebApp.htmlToText(e));return`xlink:href="#" ${[`data-ctrl="${amiWebApp.textToHtml(n["data-ctrl"])}"`,`data-ctrl-location="${amiWebApp.textToHtml(n["data-ctrl-location"])}"`,`data-params="${amiWebApp.textToHtml(JSON.stringify(n["data-params"]))}"`,`data-options="${amiWebApp.textToHtml(JSON.stringify(n["data-options"]))}"`,`data-icon="${amiWebApp.textToHtml(n["data-icon"])}"`,`data-title="${amiWebApp.textToHtml(n["data-title"])}"`,`data-title-icon="${amiWebApp.textToHtml(n["data-title-icon"])}"`].join(" ")}`}));const e=(new DOMParser).parseFromString(this.graph,"image/svg+xml");$(e.documentElement).find("a[data-title-icon]").each(((t,e)=>{$(`<tspan font-family="bootstrap-icons" class="align-items-center">${String.fromCharCode(`0x${$(e).attr("data-title-icon").replace(/f1f8/,"f5dd")}`)}</tspan><tspan> </tspan>`).prependTo($(e).find("text"))})),this.graph=e.documentElement.outerHTML;const n={graph:this.graph};return this.replaceHTML(this.patchId("#A0F6763F_DE29_5185_35C1_DCAA81E8C487"),this.fragmentGraph,{dict:n}).done((()=>{$(this.patchId("#A0F6763F_DE29_5185_35C1_DCAA81E8C487")+" a[data-ctrl]").click((t=>{t.preventDefault(),this.createControlFromWebLink(this.getParent(),t.currentTarget,this.ctx)})),amiWebApp.unlock(),t.resolveWith(this,[t])})),t.promise()},switchDirection:function(){const t=new RegExp('(.*s*rankdirs*=s*")([L][R]|[T][B])("s*.*)'),e=this.dotString.match(t)[2];"LR"===e?(this.dotString=this.dotString.replace(t,"$1TB$3"),this.ctx.direction="TB"):"TB"===e&&(this.dotString=this.dotString.replace(t,"$1LR$3"),this.ctx.direction="LR"),this.display()},exportSVG:function(){const t=new Blob([this.graph],{type:"image/svg+xml",endings:"native"});saveAs(t,"graph.svg")},jsonToDot:function(t,e){let n=amiWebApp.jspath('..rowset{.@type==="node"}.row',t)||[],i=amiWebApp.jspath('..rowset{.@type==="edge"}.row',t)||[],a=new Map;[...i].forEach((t=>{let e,n=amiWebApp.jspath('..field{.@name==="source"}.$',t)[0]||"",i=amiWebApp.jspath('..field{.@name==="destination"}.$',t)[0]||"";e=a.has(n)?a.get(n):[],e.push(i),a.set(n,e)}));let r=`digraph "provenance" {graph [rankdir="${this.ctx.direction}", ranksep="0.30"]; node [width="7.5em",height="0.3em", fontcolor="#004bffff", fontname="Arial", fontsize="10.0", shape="rectangle"];`;const o=new RegExp(e);return[...n].forEach((t=>{let n=amiWebApp.jspath('..field{.@name==="label"}.$',t)[0]||"";if(""===e||o.test(n))r+=`"${n}"\n\t\t\t\t[\n\t\t\t\t\tcolor="${amiWebApp.jspath('..field{.@name==="colour"}.$',t)[0]||""}",\n\t\t\t\t\tlabel="${n}"\n\t\t\t\t`,"0"===(amiWebApp.jspath('..field{.@name==="distance"}.$',t)[0]||"")?r+=', style ="filled, rounded"':r+=', style ="filled"',r+=`, URL="${this.url(amiWebApp.jspath('..field{.@name==="identifier"}.$',t)[0]||"",amiWebApp.jspath('..field{.@name==="catalog"}.$',t)[0]||"",amiWebApp.jspath('..field{.@name==="icon"}.$',t)[0]||"")}"\n\t\t\t\t]`;else{let t=a.get(n)||"";a.delete(n),a.forEach(((e,i)=>{[...e].forEach(((r,o)=>{r===n&&(""===t?a.set(i,e.slice(0,o).concat(e.slice(o+1))):a.set(i,e.slice(0,o).concat(t).concat(e.slice(o+1))))}))}))}})),a.forEach(((t,e)=>{[...t].forEach((t=>{let n=amiWebApp.jspath(`..{.field{.@name === "source"}.$ === "${e}" && .field{.@name === "destination"}.$ === "${t}"}`,i)[0]||"";r+=`"${e}" -> "${t}"${n?"":' [style="dashed"]'}`}))})),r+="}",r},url:function(t,e,n){return amiWebApp.textToHtml(`{\n\t"data-ctrl": "elementInfo",\n\t"data-params": ["${e}", "DATASET", "IDENTIFIER", "${t}"],\n\t"data-options": {\n\t\t"expandedLinkedElements": [\n\t\t\t{\n\t\t\t\t"catalog": "${e}",\n\t\t\t\t"entity": "PHYSICSPARAMETERVALS",\n\t\t\t\t"fields": ["PARAMNAME", "PARAMVALUE", "UNITS", "PHYSICSGROUP"],\n\t\t\t\t"keyValMode": true\n\t\t\t}, {\n\t\t\t\t"catalog": "${e}",\n\t\t\t\t"entity": "DATASET_EXTRA",\n\t\t\t\t"fields": ["FIELD", "VALUE"],\n\t\t\t\t"keyValMode": true\n\t\t\t}\n\t\t]\n\t},\n\t"data-icon": "arrows-fullscreen",\n\t"data-title": "DATASET" ${n?`, "data-title-icon": "${n}"`:""}\n}`)}})})();