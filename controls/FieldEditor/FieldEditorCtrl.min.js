(()=>{"use strict";var t={540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},1113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},5056:(t,e,a)=>{t.exports=function(t){var e=a.nc;e&&t.setAttribute("nonce",e)}},5072:t=>{var e=[];function a(t){for(var a=-1,n=0;n<e.length;n++)if(e[n].identifier===t){a=n;break}return a}function n(t,n){for(var o={},r=[],s=0;s<t.length;s++){var l=t[s],d=n.base?l[0]+n.base:l[0],p=o[d]||0,m="".concat(d," ").concat(p);o[d]=p+1;var c=a(m),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==c)e[c].references++,e[c].updater(u);else{var f=i(u,n);n.byIndex=s,e.splice(s,0,{identifier:m,updater:f,references:1})}r.push(m)}return r}function i(t,e){var a=e.domAPI(e);a.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;a.update(t=e)}else a.remove()}}t.exports=function(t,i){var o=n(t=t||[],i=i||{});return function(t){t=t||[];for(var r=0;r<o.length;r++){var s=a(o[r]);e[s].references--}for(var l=n(t,i),d=0;d<o.length;d++){var p=a(o[d]);0===e[p].references&&(e[p].updater(),e.splice(p,1))}o=l}}},6402:(t,e,a)=>{a.d(e,{A:()=>s});var n=a(9547),i=a.n(n),o=a(8532),r=a.n(o)()(i());r.push([t.id,'.field-edit [data-action="edit-row"]:hover {\n\n\tbackground-color: rgb(248, 215, 218);\n\tborder-radius: 0.25rem;\n\tcursor: pointer;\n}\n\n#A8572167_6898_AD6F_8EAD_9D4E2AEB3550 .nav-tabs,\n#F44687A3_036C_9C77_3284_DD495D9F4D7D .nav-tabs {\n\n\tborder-bottom: 0px;\n\tmargin-bottom: 1px;\n}\n\n#A8572167_6898_AD6F_8EAD_9D4E2AEB3550 .nav-link,\n#F44687A3_036C_9C77_3284_DD495D9F4D7D .nav-link {\n\n\tpadding: 0px 4px;\n}\n\n#A8572167_6898_AD6F_8EAD_9D4E2AEB3550 .form-control {\n\n\tborder-top-right-radius: 0;\n}\n',""]);const s=r},7659:t=>{var e={};t.exports=function(t,a){var n=function(t){if(void 0===e[t]){var a=document.querySelector(t);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(t){a=null}e[t]=a}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(a)}},7825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(a){!function(t,e,a){var n="";a.supports&&(n+="@supports (".concat(a.supports,") {")),a.media&&(n+="@media ".concat(a.media," {"));var i=void 0!==a.layer;i&&(n+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),n+=a.css,i&&(n+="}"),a.media&&(n+="}"),a.supports&&(n+="}");var o=a.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,a)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},8532:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var a="",n=void 0!==e[5];return e[4]&&(a+="@supports (".concat(e[4],") {")),e[2]&&(a+="@media ".concat(e[2]," {")),n&&(a+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),a+=t(e),n&&(a+="}"),e[2]&&(a+="}"),e[4]&&(a+="}"),a}).join("")},e.i=function(t,a,n,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(n)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(r[l]=!0)}for(var d=0;d<t.length;d++){var p=[].concat(t[d]);n&&r[p[0]]||(void 0!==o&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=o),a&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=a):p[2]=a),i&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=i):p[4]="".concat(i)),e.push(p))}},e}},9547:t=>{t.exports=function(t){return t[1]}}},e={};function a(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={id:n,exports:{}};return t[n](o,o.exports,a),o.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.nc=void 0;var n=a(5072),i=a.n(n),o=a(7825),r=a.n(o),s=a(7659),l=a.n(s),d=a(5056),p=a.n(d),m=a(540),c=a.n(m),u=a(1113),f=a.n(u),_=a(6402),h={};h.styleTagTransform=f(),h.setAttributes=p(),h.insert=l().bind(null,"head"),h.domAPI=r(),h.insertStyleElement=c();i()(_.A,h);_.A&&_.A.locals&&_.A.locals;amiTwig.stdlib.getAMITypeToEnumOptions=function(t,e){const a=t.indexOf("("),n=t.lastIndexOf(")");if(a<0||n<0||a>n)return"";const i=t.substring(a+1,n-0).split(","),o=[];return i.forEach(t=>{(t=amiWebApp.textToHtml(t.replace(/'/g,"").trim())).toUpperCase()===e.toUpperCase()?o.push(`<option value="${t}" selected="selected">${t}</option>`):o.push(`<option value="${t}" xxxxxxx="xxxxxxxxx">${t}</option>`)}),o.join("")},$AMIClass("FieldEditorCtrl",{$extends:ami.Control,$init:function(t,e){this.$super.$init(t,e)},onReady:function(){amiWebApp.appendHTML("body",'\x3c!-- ******************************************************************** --\x3e\n\n<div class="modal fade" data-backdrop="static" role="dialog" id="A8572167_6898_AD6F_8EAD_9D4E2AEB3550">\n\t<div class="modal-dialog modal-lg" role="document">\n\t\t<div class="modal-content">\n\t\t\t<div class="modal-header">\n\t\t\t\t<h4 class="modal-title"><i class="bi bi-pencil"></i> Row editor for <span class="badge rounded-pill bg-primary" id="E44B299D_96B3_9C00_C91C_555C549BF87B"></span></h4>\n\t\t\t</div>\n\t\t\t<div class="modal-body">\n\t\t\t\t<form id="F2E58136_73F5_D2E2_A0B7_2F810830AD98"></form>\n\t\t\t</div>\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>\n\t\t\t\t<button type="reset" form="F2E58136_73F5_D2E2_A0B7_2F810830AD98" class="btn btn-danger">Reset</button>\n\t\t\t\t<button type="submit" form="F2E58136_73F5_D2E2_A0B7_2F810830AD98" class="btn btn-primary">Append</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n\x3c!-- ******************************************************************** --\x3e\n\n<div class="modal fade" data-backdrop="static" role="dialog" id="F44687A3_036C_9C77_3284_DD495D9F4D7D">\n\t<div class="modal-dialog modal-lg" role="document">\n\t\t<div class="modal-content">\n\t\t\t<div class="modal-header">\n\t\t\t\t<h4 class="modal-title"><i class="bi bi-pencil"></i> Field editor for <span class="badge badge-pill bg-primary" id="D3CE601F_C7BA_5C8E_2564_491FED4C5D6F"></span></h4>\n\t\t\t</div>\n\t\t\t<div class="modal-body">\n\t\t\t\t<form id="C2C43049_4CD6_73C3_597B_F0399A220610"></form>\n\t\t\t</div>\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>\n\t\t\t\t<button type="reset" form="C2C43049_4CD6_73C3_597B_F0399A220610" class="btn btn-danger">Reset</button>\n\t\t\t\t<button type="submit" form="C2C43049_4CD6_73C3_597B_F0399A220610" class="btn btn-primary">Change</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n\x3c!-- ******************************************************************** --\x3e\n').done(()=>{const t=$("#A8572167_6898_AD6F_8EAD_9D4E2AEB3550"),e=$("#F44687A3_036C_9C77_3284_DD495D9F4D7D");t.on("shown.bs.modal",()=>{t.find(":input:not([readonly])").first().focus()}),e.on("shown.bs.modal",()=>{e.find(":input:not([readonly])").first().focus()}),this.fragmentFieldList='{% for info in fieldInfo %}\n{%   if ((filter is not empty) and (info.field === filter)) or ((filter is empty) and (info.field !== primaryField)) %}\n\n{%     set rand = random() %}\n{%     set name = info.field %}\n{%     set type = info.type %}\n{%     set nullable = (info.nullable === \'true\') %}\n\n{%     set value = values[info.field] or info.def %}\n\n{#     -------------------------------------------------------------------------------------------------------------- #}\n{%     if info.media !== \'false\' %}\n{#     -------------------------------------------------------------------------------------------------------------- #}\nmedia {{info.media}}\n{#     -------------------------------------------------------------------------------------------------------------- #}\n{%     else %}\n{#     -------------------------------------------------------------------------------------------------------------- #}\n\n{%       set ctx = {"doCustomLabel": false, "doCustomInput": false, "doCustomHTML": false} %}\n\n{%       if hasCustomLabels %}\n{%         set _label = include(\'customLabels\') %}\n{%       endif %}\n\n{%       if hasCustomInputs %}\n{%         set _input = include(\'customInputs\') %}\n{%       endif %}\n\n{%       if hasCustomHTMLs %}\n{%         set _html = include(\'customHTMLs\') %}\n{%       endif %}\n\n{#       ------------------------------------------------------------------------------------------------------------ #}\n{%       if ctx.doCustomInput %}\n{#       ------------------------------------------------------------------------------------------------------------ #}\n<div class="mb-2 row">\n\n\t{% if ctx.doCustomLabel %}\n\t{{ _label }}\n\t{% else %}\n\t<label class="col-sm-3 col-form-label" for="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}">{{name|e}}</label>\n\t{% endif %}\n\n\t{{ _input }}\n\n\t{% if ctx.doCustomHTML %}\n\t{{ _html }}\n\t{% endif %}\n\n</div>\n{#       ------------------------------------------------------------------------------------------------------------ #}\n{%       else %}\n{#       ------------------------------------------------------------------------------------------------------------ #}\n<ul class="nav nav-tabs ami-field-list-type" role="tablist">\n    {% if nullable %}\n\t<li class="nav-item m{% if BOOTSTRAP_VERSION > 4 %}s{% else %}l{% endif %}-auto">\n\t\t<div class="nav-link{% if value === \'@NULL\' %} active{% endif %}" role="tab">\n\t\t\t<a href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" data-action="changeamitype" data-ami-type="@NULL" data-sql-type="{{info.type|e}}">\n\t\t\t\tNULL\n\t\t\t</a>\n\t\t</div>\n\t</li>\n\t{% endif %}\n\t<li class="nav-item {% if nullable %}m{% if BOOTSTRAP_VERSION > 4 %}s{% else %}l{% endif %}-xxxx{% else %}m{% if BOOTSTRAP_VERSION > 4 %}s{% else %}l{% endif %}-auto{% endif %}">\n\t\t<div class="nav-link{% if value !== \'@NULL\' %} active{% endif %}" role="tab">\n\t\t\t<a href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" data-action="changeamitype" data-ami-type="{{type}}" data-sql-type="{{info.type|e}}">\n\t\t\t\t{% if     type === \'BOOL\'%}\n\t\t\t\tBoolean\n\t\t\t\t{% elseif type === \'INT\' %}\n\t\t\t\tInteger\n\t\t\t\t{% elseif type === \'REAL\' %}\n\t\t\t\tReal\n\t\t\t\t{% elseif type === \'TIMESTAMP\' %}\n\t\t\t\tTimestamp\n\t\t\t\t{% elseif type === \'DATE\' %}\n\t\t\t\tDate\n\t\t\t\t{% elseif type === \'TIME\' %}\n\t\t\t\tTime\n\t\t\t\t{% elseif type starts with \'ENUM\' %}\n\t\t\t\tEnum\n\t\t\t\t{% elseif type === \'LONGTEXT\' %}\n\t\t\t\tLong text\n\t\t\t\t{% elseif type === \'TEXT\' %}\n\t\t\t\tShort text\n\t\t\t\t{% endif %}\n\t\t\t</a>\n\t\t\t<a class="dropdown-toggle" href="#" data-bs-toggle="dropdown"></a>\n\t\t\t<div class="dropdown-menu">\n\t\t\t\t<a class="dropdown-item{% if type === \'BOOL\' %} active{% endif %}" href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" role="tab" data-action="changeamitype" data-ami-type="BOOL" data-sql-type="{{info.type|e}}">Boolean</a>\n\t\t\t\t<a class="dropdown-item{% if type === \'INT\' %} active{% endif %}" href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" role="tab" data-action="changeamitype" data-ami-type="INT" data-sql-type="{{info.type|e}}">Integer</a>\n\t\t\t\t<a class="dropdown-item{% if type === \'REAL\' %} active{% endif %}" href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" role="tab" data-action="changeamitype" data-ami-type="REAL" data-sql-type="{{info.type|e}}">Real</a>\n\t\t\t\t<a class="dropdown-item{% if type === \'TIMESTAMP\' %} active{% endif %}" href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" role="tab" data-action="changeamitype" data-ami-type="TIMESTAMP" data-sql-type="{{info.type|e}}">Timestamp</a>\n\t\t\t\t<a class="dropdown-item{% if type === \'DATE\' %} active{% endif %}" href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" role="tab" data-action="changeamitype" data-ami-type="DATE" data-sql-type="{{info.type|e}}">Date</a>\n\t\t\t\t<a class="dropdown-item{% if type === \'TIME\' %} active{% endif %}" href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" role="tab" data-action="changeamitype" data-ami-type="TIME" data-sql-type="{{info.type|e}}">Time</a>\n\t\t\t\t<a class="dropdown-item{% if type starts with \'ENUM\' %} active{% endif %}" href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" role="tab" data-action="changeamitype" data-ami-type="ENUM" data-sql-type="{{info.type|e}}">Enum</a>\n\t\t\t\t<a class="dropdown-item{% if type === \'LONGTEXT\' %} active{% endif %}" href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" role="tab" data-action="changeamitype" data-ami-type="LONGTEXT" data-sql-type="{{info.type|e}}">Long text</a>\n\t\t\t\t<a class="dropdown-item{% if type === \'TEXT\' %} active{% endif %}" href="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" role="tab" data-action="changeamitype" data-ami-type="TEXT" data-sql-type="{{info.type|e}}">Short text</a>\n\t\t\t</div>\n\t\t</div>\n\t</li>\n</ul>\n\n<div class="form-group mb-1 row">\n\n\t{% if ctx.doCustomLabel %}\n\t{{ _label }}\n\t{% else %}\n\t<label class="col-sm-3 col-form-label" for="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}">{{name|e}}</label>\n\t{% endif %}\n\n\t<div class="col-sm-9">\n\t\t{% if nullable and value === \'@NULL\' %}\n\t\t<input class="form-control form-control-sm" type="text" name="{{name|e}}" value="{{value|e}}" readonly="readonly" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" />\n\t\t{% elseif type === \'BOOL\' %}\n\t\t<select class="{% if BOOTSTRAP_VERSION > 4 %}form-select form-select-sm{% else %}custom-select custom-select-sm{% endif %}" name="{{name|e}}" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}">\n\t\t\t<option value="0" {% if value === \'0\' %}selected="selected"{% endif %}>0</option>\n\t\t\t<option value="1" {% if value !== \'0\' %}selected="selected"{% endif %}>1</option>\n\t\t</select>\n\t\t{% elseif type === \'INT\' %}\n\t\t<input class="form-control form-control-sm" type="number" name="{{name|e}}" value="{{value|e}}" step="1" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" />\n\t\t{% elseif type === \'REAL\' %}\n\t\t<input class="form-control form-control-sm" type="number" name="{{name|e}}" value="{{value|e}}" step="any" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" />\n\t\t{% elseif type === \'TIMESTAMP\' %}\n\t\t<input class="form-control form-control-sm form-datetime" type="text" name="{{name|e}}" value="{{value|e}}" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" data-target="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" />\n\t\t{% elseif type === \'DATE\' %}\n\t\t<input class="form-control form-control-sm form-date" type="text" name="{{name|e}}" value="{{value|e}}" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" data-target="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" />\n\t\t{% elseif type === \'TIME\' %}\n\t\t<input class="form-control form-control-sm form-time" type="text" name="{{name|e}}" value="{{value|e}}" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" data-target="#F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" />\n\t\t{% elseif type starts with \'ENUM\' %}\n\t\t<select class="{% if BOOTSTRAP_VERSION > 4 %}form-select form-select-sm{% else %}custom-select custom-select-sm{% endif %}" name="{{name|e}}" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}">{{ getAMITypeToEnumOptions(info.type, value) }}</select>\n\t\t{% elseif type === \'LONGTEXT\' %}\n\t\t<textarea class="form-control form-control-sm" name="{{name|e}}" rows="6" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}">{{value|e}}</textarea>\n\t\t{% elseif type === \'TEXT\' %}\n\t\t<input class="form-control form-control-sm" type="text" name="{{name|e}}" value="{{value|e}}" id="F6E6F7A4_5096_9F54_0726_60CCFE19FB4A_{{rand}}" />\n\t\t{% endif %}{{ cnt }}\n\t</div>\n\n\t{% if ctx.doCustomHTML %}\n\t{{ _html }}\n\t{% endif %}\n\n</div>\n{#       ------------------------------------------------------------------------------------------------------------ #}\n{%       endif %}\n{#       ------------------------------------------------------------------------------------------------------------ #}\n{#     -------------------------------------------------------------------------------------------------------------- #}\n{%     endif %}\n{#     -------------------------------------------------------------------------------------------------------------- #}\n{%   endif %}\n{% endfor %}\n',this.cache={}})},getInfo:function(t,e,a){const n=$.Deferred(),i=`${t}$${e}`;if(i in this.cache)return n.resolve(this.cache[i].primaryField,this.cache[i].fieldInfo,this.cache[i].foreignKeysInfo);const o=[],r=[];return amiCommand.execute(`GetEntityInfo -catalog="${amiWebApp.textToString(t)}" -entity="${amiWebApp.textToString(e)}"`).done(i=>{const s=amiWebApp.jspath('..{.@type==="fields"}.row',i);for(let n in s){const i=amiWebApp.jspath('..field{.@name==="field"}.$',s[n])[0]||"",r=amiWebApp.jspath('..field{.@name==="type"}.$',s[n])[0]||"",l=amiWebApp.jspath('..field{.@name==="nullable"}.$',s[n])[0]||"false",d=amiWebApp.jspath('..field{.@name==="def"}.$',s[n])[0]||"",p=amiWebApp.jspath('..field{.@name==="media"}.$',s[n])[0]||"false",m=amiWebApp.jspath('..field{.@name==="primary"}.$',s[n])[0]||"false",c=amiWebApp.jspath('..field{.@name==="automatic"}.$',s[n])[0]||"false",u=amiWebApp.jspath('..field{.@name==="created"}.$',s[n])[0]||"false",f=amiWebApp.jspath('..field{.@name==="createdBy"}.$',s[n])[0]||"false",_=amiWebApp.jspath('..field{.@name==="modified"}.$',s[n])[0]||"false",h=amiWebApp.jspath('..field{.@name==="modifiedBy"}.$',s[n])[0]||"false";"true"===m&&(a=i),"true"!==c&&"true"!==u&&"true"!==f&&"true"!==_&&"true"!==h&&o.push({catalog:t,entity:e,field:i,type:r,nullable:l,def:d,media:p})}const l=amiWebApp.jspath('..{.@type==="foreignKeys"}.row',i);for(let t in l){const e=amiWebApp.jspath('..field{.@name==="name"}.$',l[t])[0]||"",a=amiWebApp.jspath('..field{.@name==="fkExternalCatalog"}.$',l[t])[0]||"",n=amiWebApp.jspath('..field{.@name==="fkInternalCatalog"}.$',l[t])[0]||"",i=amiWebApp.jspath('..field{.@name==="fkEntity"}.$',l[t])[0]||"",o=amiWebApp.jspath('..field{.@name==="fkColumn"}.$',l[t])[0]||"",s=amiWebApp.jspath('..field{.@name==="pkExternalCatalog"}.$',l[t])[0]||"",d=amiWebApp.jspath('..field{.@name==="pkInternalCatalog"}.$',l[t])[0]||"",p=amiWebApp.jspath('..field{.@name==="pkEntity"}.$',l[t])[0]||"",m=amiWebApp.jspath('..field{.@name==="pkColumn"}.$',l[t])[0]||"";r.push({name:e,fkExternalCatalog:a,fkInternalCatalog:n,fkEntity:i,fkColumn:o,pkExternalCatalog:s,pkInternalCatalog:d,pkEntity:p,pkColumn:m})}n.resolve(a,o,r)}).fail((t,e)=>{n.reject(e)}),n},getValues:function(t,e,a,n){const i=$.Deferred(),o={};return amiCommand.execute(`SearchQuery -catalog="${amiWebApp.textToString(t)}" -entity="${amiWebApp.textToString(e)}" -sql="SELECT * FROM \`${amiWebApp.textToString(e)}\` WHERE \`${amiWebApp.textToString(a)}\` = '${amiWebApp.textToString(n)}'"`).done(e=>{const a=amiWebApp.jspath(`..{.@type==="${amiWebApp.textToString(t)}"}..field`,e);for(let t in a)o[a[t]["@name"]]=a[t].$;i.resolve(o)}).fail((t,e)=>{i.reject(e)}),i},setup:function(t,e){const[a,n,i,o,r,s,l]=amiWebApp.setup(["elementInfoCommandFunc","appendCommandFunc","updateCommandFunc","removeCommandFunc","customLabelsFragment","customInputsFragment","customHTMLsFragment"],[(t,e,a,n,i)=>`GetElementInfo -catalog="${amiWebApp.textToString(t)}" -entity="${amiWebApp.textToString(e)}" -primaryFieldName="${amiWebApp.textToString(a)}" -primaryFieldValue="${amiWebApp.textToString(n)}"${i?" -hideBigContent":""}`,(t,e,a,n)=>`AddElement -catalog="${amiWebApp.textToString(t)}" -entity="${amiWebApp.textToString(e)}" -separator="§" -fields="${amiWebApp.textToString(a.join("§"))}" -values="${amiWebApp.textToString(n.join("§"))}"`,(t,e,a,n,i,o)=>`UpdateElements -catalog="${amiWebApp.textToString(t)}" -entity="${amiWebApp.textToString(e)}" -separator="§" -fields="${amiWebApp.textToString(a.join("§"))}" -values="${amiWebApp.textToString(n.join("§"))}" -keyFields="${amiWebApp.textToString(i.join("§"))}" -keyValues="${amiWebApp.textToString(o.join("§"))}"`,(t,e,a,n)=>`RemoveElements -catalog="${amiWebApp.textToString(t)}" -entity="${amiWebApp.textToString(e)}" -separator="§" -keyFields="${amiWebApp.textToString(a.join("§"))}" -keyValues="${amiWebApp.textToString(n.join("§"))}"`,null,null,null],e),d=!!(r||"").trim(),p=!!(s||"").trim(),m=!!(l||"").trim();this.ctx={inEditMode:!1,elementInfoCommandFunc:a,appendCommandFunc:n,updateCommandFunc:i,removeCommandFunc:o,hasCustomLabels:d,customLabelsFragment:r,hasCustomInputs:p,customInputsFragment:s,hasCustomHTMLs:m,customHTMLsFragment:l,sql:e.sql||"N/A"},this.el=$(t),this.el.find('div[data-action="edit-row"]').click(t=>{t.preventDefault(),this.ctx.inEditMode&&this.showFieldModal(t.currentTarget.getAttribute("data-primary-catalog"),t.currentTarget.getAttribute("data-primary-entity"),t.currentTarget.getAttribute("data-primary-field"),t.currentTarget.getAttribute("data-primary-value"),t.currentTarget.getAttribute("data-catalog"),t.currentTarget.getAttribute("data-entity"),t.currentTarget.getAttribute("data-field"),t.currentTarget.getAttribute("data-type"))}),this.el.find('[data-action="clone-row"]').click(t=>{t.preventDefault(),this.ctx.inEditMode&&this.showRowModal(t.currentTarget.getAttribute("data-catalog"),t.currentTarget.getAttribute("data-entity"),t.currentTarget.getAttribute("data-primary-field"),t.currentTarget.getAttribute("data-primary-value"))}),this.el.find('[data-action="delete-row"]').click(t=>{t.preventDefault(),this.ctx.inEditMode&&this.removeRow(t.currentTarget.getAttribute("data-catalog"),t.currentTarget.getAttribute("data-entity"),[t.currentTarget.getAttribute("data-primary-field")],[t.currentTarget.getAttribute("data-primary-value")])})},isInEditMode:function(){return this.ctx.inEditMode},setInEditMode:function(t){t?this.el.removeClass("unit-edit"):this.el.addClass("unit-edit"),this.ctx.inEditMode=t},changeFormInputType:function(t,e,a){const n=$(t).prop("name"),i=$(t).val();let o;o="@NULL"===e?'<input class="form-control form-control-sm" type="text" readonly="readonly" />':"BOOL"===e?'<select class="custom-select custom-select-sm"><option value="0">0</option><option value="1">1</option></select>':"INT"===e?'<input class="form-control form-control-sm" type="number" step="1" />':"REAL"===e?'<input class="form-control form-control-sm" type="number" step="any" />':"TIMESTAMP"===e?`<input class="form-control form-control-sm form-datetime" type="text" data-target="${t}" />`:"DATE"===e?`<input class="form-control form-control-sm form-date" type="text" data-target="${t}" />`:"TIME"===e?`<input class="form-control form-control-sm form-time" type="text" data-target="${t}" />`:"ENUM"===e?`<select class="custom-select custom-select-sm">${amiTwig.stdlib.getAMITypeToEnumOptions(a,i)}</select>`:"LONGTEXT"===e?'<textarea class="form-control form-control-sm" rows="6"></textarea>':'<input class="form-control form-control-sm" type="text" />',amiWebApp.parentHTML(t,o).done(t=>{t.attr("name",n).val("@NULL"!==e?"@NULL"!==i?i:"":"@NULL")})},showFieldModal:function(t,e,a,n,i,o,r,s){t===i&&e===o&&this.getInfo(t,e,a).done((a,s)=>{this.getValues(t,e,a,n).done(l=>{const d={primaryCatalog:t,primaryEntity:e,primaryField:a,fieldInfo:s,values:l,filter:r,hasCustomLabels:this.ctx.hasCustomLabels,hasCustomInputs:this.ctx.hasCustomInputs,hasCustomHTMLs:this.ctx.hasCustomHTMLs,inEditMode:this.ctx.inEditMode},p={customLabels:this.ctx.customLabelsFragment,customInputs:this.ctx.customInputsFragment,customHTMLs:this.ctx.customHTMLsFragment};amiWebApp.replaceHTML("#C2C43049_4CD6_73C3_597B_F0399A220610",this.fragmentFieldList,{dict:d,twigs:p}).done(()=>{const t=$("#F44687A3_036C_9C77_3284_DD495D9F4D7D"),e=$("#D3CE601F_C7BA_5C8E_2564_491FED4C5D6F"),s=$("#C2C43049_4CD6_73C3_597B_F0399A220610");e.text(`${i}.${o}.${a} = ${n}`),s.find('[data-action="changeamitype"]').click(t=>{t.preventDefault(),$(t.currentTarget).closest(".nav-item").find(".nav-link").addClass("active").children().first().attr("data-ami-type",$(t.currentTarget).attr("data-ami-type")).attr("data-sql-type",$(t.currentTarget).attr("data-sql-type")).text($(t.currentTarget).text().replace("default","")),this.changeFormInputType(t.currentTarget.getAttribute("href"),t.currentTarget.getAttribute("data-ami-type"),t.currentTarget.getAttribute("data-sql-type"))}),s.off().on("submit",t=>{t.preventDefault();const e=s.find(":input").val();this.updateRow(i,o,[r],[e],[a],[n])}),t.modal("show")})}).fail(t=>{this.error(t,!0)})}).fail(t=>{this.error(t,!0)})},showRowModal:function(t,e,a,n){const i=this.ctx.sql?.substring(this.ctx.sql?.indexOf("FROM"));i&&this.getInfo(t,e,a).done((a,o,r)=>{this.getValues(t,e,a,n).done(n=>{if(0!==r.length&&0===Object.keys(n).length){const s=[];for(let t in r)s.push(`\`${r[t].fkInternalCatalog}\`.\`${r[t].fkEntity}\`.\`${r[t].fkColumn}\``);const l=`SELECT DISTINCT ${s.join()} ${i}`;amiCommand.execute('SearchQuery -catalog=? -entity="? -sql=?',{params:[t,e,l]}).done(i=>{if(1===(amiWebApp.jspath("..row",i)||[]).length){const t=amiWebApp.jspath("..field",i)||[];for(let e in t)n[t[e]["@name"]]=t[e].$}const r={primaryCatalog:t,primaryEntity:e,primaryField:a,fieldInfo:o,values:n,filter:"",hasCustomLabels:this.ctx.hasCustomLabels,hasCustomInputs:this.ctx.hasCustomInputs,hasCustomHTMLs:this.ctx.hasCustomHTMLs,inEditMode:this.ctx.inEditMode};this._showRowModal(r)}).fail((t,e)=>{amiWebApp.error(e,!0)})}else{const i={primaryCatalog:t,primaryEntity:e,primaryField:a,fieldInfo:o,values:n,filter:"",hasCustomLabels:this.ctx.hasCustomLabels,hasCustomInputs:this.ctx.hasCustomInputs,hasCustomHTMLs:this.ctx.hasCustomHTMLs,inEditMode:this.ctx.inEditMode};this._showRowModal(i)}}).fail(t=>{this.error(t,!0)})}).fail(t=>{this.error(t,!0)})},_showRowModal:function(t){const e={customLabels:this.ctx.customLabelsFragment,customInputs:this.ctx.customInputsFragment,customHTMLs:this.ctx.customHTMLsFragment};amiWebApp.replaceHTML("#F2E58136_73F5_D2E2_A0B7_2F810830AD98",this.fragmentFieldList,{dict:t,twigs:e}).done(()=>{const e=$("#A8572167_6898_AD6F_8EAD_9D4E2AEB3550"),a=$("#E44B299D_96B3_9C00_C91C_555C549BF87B"),n=$("#F2E58136_73F5_D2E2_A0B7_2F810830AD98");a.text(`${t.primaryCatalog}.${t.primaryEntity}`),n.find('[data-action="changeamitype"]').click(t=>{t.preventDefault(),$(t.currentTarget).closest(".nav-item").find(".nav-link").addClass("active").children().first().attr("data-ami-type",$(t.currentTarget).attr("data-ami-type")).attr("data-sql-type",$(t.currentTarget).attr("data-sql-type")).text($(t.currentTarget).text().replace("default","")),this.changeFormInputType(t.currentTarget.getAttribute("href"),t.currentTarget.getAttribute("data-ami-type"),t.currentTarget.getAttribute("data-sql-type"))}),n.off().submit(e=>{e.preventDefault();const a=[],i=[],o=n.serializeArray();for(let t in o)a.push(o[t].name),i.push(o[t].value);this.appendRow(t.primaryCatalog,t.primaryEntity,a,i)}),e.modal("show")})},appendRow:function(t,e,a,n){const i=confirm("Please confirm!");return i&&(amiWebApp.lock(),amiCommand.execute(this.ctx.appendCommandFunc(t,e,a,n)).done((t,e)=>{$("#A8572167_6898_AD6F_8EAD_9D4E2AEB3550").modal("hide"),this.success(e,!0)}).fail((t,e)=>{this.error(e,!0)})),i},updateRow:function(t,e,a,n,i,o){const r=confirm("Please confirm!");return r&&(amiWebApp.lock(),amiCommand.execute(this.ctx.updateCommandFunc(t,e,a,n,i,o)).done((t,e)=>{$("#F44687A3_036C_9C77_3284_DD495D9F4D7D").modal("hide"),this.success(e,!0)}).fail((t,e)=>{this.error(e,!0)})),r},removeRow:function(t,e,a,n){const i=confirm("Please confirm!");return i&&(amiWebApp.lock(),amiCommand.execute(this.ctx.removeCommandFunc(t,e,a,n)).done((t,e)=>{this.success(e,!0)}).fail((t,e)=>{this.error(e,!0)})),i},success:function(t,e,a){this.getOwner().refresh?amiWebApp._internal_then(this.getOwner().refresh(),()=>{amiWebApp.success(t,e,a)},t=>{amiWebApp.error(t,e,a)}):amiWebApp.success(t,e,a)},error:function(t,e,a){this.getOwner().refresh?amiWebApp._internal_then(this.getOwner().refresh(),()=>{amiWebApp.error(t,e,a)},t=>{amiWebApp.error(t,e,a)}):amiWebApp.error(t,e,a)}})})();