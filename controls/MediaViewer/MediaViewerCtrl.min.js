(()=>{"use strict";$AMIClass("MediaViewerCtrl",{$extends:ami.Control,$init:function(e,t){this.$super.$init(e,t)},onReady:function(){return this.fragmentMediaViewerCtrl='\x3c!--\n * AMI Web Framework\n *\n * Copyright (c) 2014-XXXX The AMI Team / LPSC / CNRS\n *\n * This file must be used under the terms of the CeCILL-C:\n * http://www.cecill.info/licences/Licence_CeCILL-C_V1-en.html\n * http://www.cecill.info/licences/Licence_CeCILL-C_V1-fr.html\n *\n--\x3e\n\n<figure class="figure" id="D25C9390_A722_9C48_BC81_5C8875CAAC95"></figure>\n',$.Deferred().resolve()},render:function(e,t,i,r,n,s,a,c,h){const l=$.Deferred();return this.setupCtx({catalog:t,entity:i,primaryFieldName:r,primaryFieldValue:n,field:s,base64:a,mime:c},{context:l,card:!1},h),this._render(l,e),l},_render:function(e,t){if("TabCtrl"!==this.getParent().$name){const i=new this.tabCtor(null,this);i.render(t,this.ctx).done(()=>{i.appendItem(`<i class="bi bi-arrows-fullscreen"></i> ${this.ctx.entity}`,{closable:!1}).done(t=>{this.setParent(i),this.__render(e,t)})})}else this.__render(e,t)},__render:function(e,t){const i={field:this.ctx.field,mime:this.ctx.mime};this.replaceHTML(t,this.fragmentMediaViewerCtrl,{dict:i}).done(()=>{this.refresh().done(t=>{e.resolveWith(this.ctx.context,[t])}).fail(t=>{e.rejectWith(this.ctx.context,[t])})})},refresh:function(e){const t=$.Deferred(),[i]=amiWebApp.setup(["context"],[t],e);return amiCommand.execute("SearchQuery -catalog=? -entity=? -sql=?",{params:[this.ctx.catalog,this.ctx.entity,`SELECT \`${amiWebApp.textToString(this.ctx.field)}\` FROM \`${amiWebApp.textToString(this.ctx.entity)}\` WHERE \`${amiWebApp.textToString(this.ctx.primaryFieldName)}\` = '${amiWebApp.textToString(this.ctx.primaryFieldValue)}'`]}).done(e=>{const r=amiWebApp.jspath("..field.$",e)[0]||"";this.ctx.mime.startsWith("image/")?$("<img />").attr({alt:this.ctx.field,src:`data:${this.ctx.mime};base64,${r}`,height:"auto",width:"800"}).appendTo(this.patchId("#D25C9390_A722_9C48_BC81_5C8875CAAC95")):$("<object />").attr({type:this.ctx.mime,data:`data:${this.ctx.mime};base64,${r}`,height:"600",width:"800"}).appendTo(this.patchId("#D25C9390_A722_9C48_BC81_5C8875CAAC95")),t.resolveWith(i,[e])}).fail((e,r)=>{t.rejectWith(i,[r])}),t}})})();