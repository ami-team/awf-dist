(()=>{"use strict";$AMIClass("SearchApp",{$extends:ami.SubApp,$init:function(){this.$super.$init()},onReady:function(e){const n=$.Deferred();return amiWebApp.loadResources(["ctrl:search","ctrl:tab"]).done((t=>{this.searchCtor=t[0],this.tabCtrl=new t[1],amiWebApp.replaceHTML("#ami_main_content",'<div class="px-3 py-0">\n\t<div class="mb-3" id="CCFE77D9_5798_A236_8108_E59AE44FB242"></div>\n\n\t<div class="mb-3" id="FE8BB925_A267_F972_060E_CC9C70D0C6D2"></div>\n</div>\n').done((()=>{this.tabCtrl.render("#FE8BB925_A267_F972_060E_CC9C70D0C6D2",{card:!1}).done((()=>{this.fragmentInterface='{% for group in groups %}\n<div>\n\t<span class="badge bg-primary px-3">{{group}}</span>\n\t<i class="bi bi-chevron-double-right"></i>\n\t{% for interface in groups[group] %}\n\t<a class="badge bg-secondary text-white px-3" href="javascript: searchApp.select(\'{{interface.id|e}}\');">{{interface.name}}</a>\n\t{% endfor %}\n</div>\n{% else %}\n<div class="alert alert-warning" role="alert">\n\tNo search interface defined yet!\n</div>\n{% endfor %}\n',this.searchInterfaces={},this.groups1=[],this.groups2=[],e&&e.split(",").forEach((e=>{const n=e.split(":");if(n.length>0){const e=n[0].trim();if(this.groups1.indexOf(e)<0&&this.groups1.push(e),n.length>1){const t=n[1].trim();this.groups2.indexOf(`${e}:${t}`)<0&&this.groups2.push(`${e}:${t}`)}}})),n.resolve()}))}))})).fail((e=>{n.reject(e)})),n},onLogin:function(){this.getInterfaceList()},onLogout:function(){this.maskInterfaceList()},getInterfaceList:function(){amiWebApp.lock();const e=0===this.groups1.length?"SELECT `id`, `group`, `name`, `rank`, `json` FROM `router_search_interface` WHERE `archived` = 0 ORDER BY `rank` ASC, `group` ASC, `name` ASC":`SELECT \`id\`, \`group\`, \`name\`, \`rank\`, \`json\` FROM \`router_search_interface\` WHERE \`archived\` = 0 AND \`group\` IN (${this.groups1.map((e=>`'${amiWebApp.textToSQL(e)}'`)).join(", ")}) ORDER BY \`rank\` ASC, \`group\` ASC, \`name\` ASC`;amiCommand.execute(`SearchQuery -catalog="self" -entity="router_search_interface" -sql="${e}"`).done((e=>{const n=amiWebApp.jspath("..row",e),t={groups:{}},a=[];n.forEach((e=>{const n=amiWebApp.jspath('..field{.@name==="id"}.$',e)[0]||"",s=amiWebApp.jspath('..field{.@name==="group"}.$',e)[0]||"",r=amiWebApp.jspath('..field{.@name==="name"}.$',e)[0]||"",i=amiWebApp.jspath('..field{.@name==="json"}.$',e)[0]||"";try{s in t.groups||(t.groups[s]=[]);const e={id:n,name:r,json:JSON.parse(i)};t.groups[s].push(e),this.searchInterfaces[n]=e,this.groups2.indexOf(`${s}:${r}`)>=0&&a.push(n)}catch(e){}})),amiWebApp.replaceHTML("#CCFE77D9_5798_A236_8108_E59AE44FB242",this.fragmentInterface,{dict:t}).done((()=>{$("#FE8BB925_A267_F972_060E_CC9C70D0C6D2").show(),a.forEach((e=>{this.select(e)})),amiWebApp.unlock()}))})).fail(((e,n)=>{amiWebApp.error(n,!0)}))},maskInterfaceList:function(){amiWebApp.replaceHTML("#CCFE77D9_5798_A236_8108_E59AE44FB242","Please sign-in.").done((()=>{$("#FE8BB925_A267_F972_060E_CC9C70D0C6D2").hide()}))},select:function(e){amiWebApp.lock();const n=this.searchInterfaces[e];this.tabCtrl.appendItem(n.name,{closable:!0}).done((e=>{n.json.name=n.name,new this.searchCtor(this.tabCtrl).render(e,n.json).always((()=>{amiWebApp.unlock()}))}))}}),window.searchApp=new SearchApp})();